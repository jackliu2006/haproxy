global
	log /dev/log	local0
	log /dev/log	local1 notice
	chroot /var/lib/haproxy
	stats socket /run/haproxy/admin.sock mode 660 level admin
	stats timeout 30s
	user haproxy
	group haproxy
	daemon

defaults
	log	global
	# Set to 'http' for the web/rest frontends to correctly process HTTP headers
	mode	tcp
	timeout connect 5s
	timeout client	50s
	timeout server	50s

# ----------------------------------------------------------------------
# FRONTENDS (Mode set for HTTP/App traffic)
# ----------------------------------------------------------------------

frontend spark_web_fe
	bind :8080
	default_backend spark_web_be

frontend spark_spark_fe
	bind :7077
	default_backend spark_spark_be

frontend spark_rest_fe
	bind :6066
	default_backend spark_rest_be

frontend kube_api_fe
	bind :6443
	default_backend kube_api_be
# ----------------------------------------------------------------------
# BACKENDS (FIXED: Names, Checks, and Protocols)
# ----------------------------------------------------------------------

backend spark_web_be
	balance leastconn
	
	server node1_web 192.168.56.21:31814 check inter 2s fall 5 rise 10
	server node2_web 192.168.56.22:31814 check inter 2s fall 5 rise 10

backend spark_spark_be
	balance leastconn
	server node1_spark 192.168.56.21:31845 check inter 2s fall 5 rise 10
	server node2_spark 192.168.56.22:31845 check inter 2s fall 5 rise 10

backend spark_rest_be
	balance leastconn
	server node1_rest 192.168.56.21:31414 check inter 2s fall 5 rise 10
	server node2_rest 192.168.56.22:31414 check inter 2s fall 5 rise 10

backend kube_api_be
	balance leastconn
	server node1_kube_api 192.168.56.21:6443 check inter 2s fall 5 rise 10
